FROM ubuntu:latest

# Sistem paketlerini güncelle ve gerekli paketleri kur
RUN apt-get update && apt-get install -y \
    sudo \
    postgresql-15 \
    python3 \
    python3-pip \
    curl \
    wget \
    gnupg2 \
    lsb-release \
    haproxy \
    etcd \
    systemctl \
    net-tools \
    vim &&
    apt-get clean &&
    rm -rf /var/lib/apt/lists/*

# ETCD kurulumu için gerekli dizinleri oluştur
RUN mkdir -p /var/lib/etcd

# Patroni kurulumu
RUN pip3 install patroni[etcd] psycopg2-binary

# HAProxy için yapılandırma dizini
RUN mkdir -p /etc/haproxy

# Patroni için yapılandırma dizini
RUN mkdir -p /etc/patroni

# PostgreSQL data dizini
RUN mkdir -p /var/lib/postgresql/15/main
RUN chown -R postgres:postgres /var/lib/postgresql

COPY ha_proxy_scripts/* /usr/local/bin/

CMD ["/bin/bash"]
